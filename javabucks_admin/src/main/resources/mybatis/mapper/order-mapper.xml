<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="mybatis.mapper.order-mapper">
  
  	<!-- 재고 리스트 개수 -->
  	<!-- 처음 들어왔을 때 -->
  	<select id="adminStockListCount" resultType="int">
		select count(*) from javabucks_stocklist
  	</select>
  	
  	<!-- 카테고리 검색 조건이 ALL일 때 -->
  	<select id="searchAdminStockListCountAll" resultType="int">
		select count(*) from javabucks_stocklist
		<if test="searchStockListName != ''">
			where stockListName like '%' || #{searchStockListName} || '%'
		</if>
		order by stockListCode asc
	</select>
	
	<!-- 카테고리 검색 조건이 ALL이 아닐 때 -->
	<select id="searchAdminStockListCount" resultType="int">
		select count(*) from javabucks_stocklist
		<if test="searchStockCate != '' and searchStockListName != ''">
			where stockListName like '%' || #{searchStockListName} || '%'
				and stockCateCode = #{searchCate}
		</if>
		<if test="searchStockCate == '' and searchStockListName != ''">
			where stockListName like '%' || #{searchStockListName} || '%'
		</if>
		<if test="searchStockCate != '' and searchStockListName == ''">
			where stockCateCode = #{searchCate}
		</if>
		order by stockListCode asc
	</select>
  	
  	<!-- 재고 리스트 -->
  	<!-- 처음 들어왔을 때 -->
  	<select id="getAdminStockList" parameterType="java.util.Map" resultType="StockListDTO">
  		select * from ( select rownum rn, A.*
						from (
	  							select * from javabucks_stocklist
	  							order by stockListCode asc	  							
	  							) A	)
	  	where rn between #{startRow} and #{endRow}
  	</select>
  	
  	<!-- 검색 cate ALL -->
 	<select id="findAdminStockListAll" parameterType="java.util.Map" resultType="StockListDTO">
 		select * from ( select rownum rn, A.*
						from (
	  							select * from javabucks_stocklist
	  							<if test="searchStockListName != ''">
									where stockListName like '%' || #{searchStockListName} || '%'
								</if>
	  							order by stockListCode asc	  							
	  							) A	)
	  	where rn between #{startRow} and #{endRow} 	
 	</select>
 	
 	<!-- 검색 cate ALL 이외 -->
 	<select id="findAdminStockList" parameterType="java.util.Map" resultType="StockListDTO">
 		select * from ( select rownum rn, A.*
						from (
	  							select * from javabucks_stocklist
	  							<if test="searchStockCate != '' and searchStockListName != ''">
									where stockListName like '%' || #{searchStockListName} || '%'
										and stockCateCode = #{searchCate}
								</if>
								<if test="searchStockCate == '' and searchStockListName != ''">
									where stockListName like '%' || #{searchStockListName} || '%'
								</if>
								<if test="searchStockCate != '' and searchStockListName == ''">
									where stockCateCode = #{searchCate}
								</if>
	  							order by stockListCode asc	  							
	  							) A	)
	  	where rn between #{startRow} and #{endRow} 	
 	</select>

  	<update id="stockPlus" parameterType="java.util.Map">
		update javabucks_stockList
		set stockListCount = #{stockCount} + 100
		where stockListCode = #{stockListCode}
  	</update>
  
  	<select id="stockCountUpdated" parameterType="java.util.Map" resultType="int">
  		select stockListCount from javabucks_stockList
  		where stockListCode = #{stockListCode}
  	</select>
  	
  	<update id="stockStatusUpdateN" parameterType="String">
  		update javabucks_stockList
  		set stockListStatus = 'N'
  		where stockListCode = #{stockListCode}
  	</update>
  	
  	<update id="stockStatusUpdateY" parameterType="String">
  		update javabucks_stockList
  		set stockListStatus = 'Y'
  		where stockListCode = #{stockListCode}
  	</update>
  	
  	<select id="baljooList" parameterType="java.util.Map" resultType="BaljooDTO">
  		select * from ( 
  						select rownum rn, C.*
  						from (
  								select A.*, B.bucksName
  								from javabucks_baljoo A
  								join javabucks_bucks B
  								on A.bucksId = B.bucksId
  								order by baljooNum desc
  						)C)
  		where rn between #{startRow} and #{endRow} 
  	</select>
  	
  	<select id="baljooCount" resultType="int">
  		select count(*) from javabucks_baljoo
  	</select>
  	
  </mapper>