<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mybatis.mapper.menu-mapper">
	<!-- 메뉴추가 - 선택된 메뉴 리스트 필터링 -->
	<select id="getSelectMenu" resultType="MenuDTO">
	    select * from javabucks_menu where substr(menuCode, 1,1) in ('B', 'C', 'M') and substr(menuCode, 2, 4) = #{menuoptCode}
	</select>
	
	<!-- 어드민에서 등록된 메뉴 지점 메뉴로 추가 -->
	<insert id="addMenu" parameterType="StoreMenuDTO">
	    INSERT INTO javabucks_storemenu (storemenuCode, bucksId, menuCode, storemenuStatus) 
	    VALUES (seq_storemenuNum.NEXTVAL, #{bucksId}, #{menuCode}, #{storemenuStatus})
	</insert>
	
	<!-- 추가된 메뉴 리스트 불러오기 - 메뉴 추가 후 상태변경, 버튼 유지 -->
	<select id="getSelectedMenu" parameterType="String" resultType="StoreMenuDTO">
		select * from javabucks_storemenu where bucksId = #{bucksId}
	</select>
	
	<!-- 조건에 해당하는 음료 리스트 뽑기 -->
	<select id="searchDrinks" parameterType="java.util.Map" resultType="StoreMenuDTO">
	    SELECT * 
	    FROM (
	        SELECT ROW_NUMBER() OVER (ORDER BY m.menuregDate DESC) AS rn, m.*
	        FROM javabucks_storemenu sm
	        JOIN javabucks_menu m ON sm.menuCode = m.menuCode
	        WHERE sm.bucksId = #{bucksId}
	          AND sm.storemenuStatus = 'Y'
	          AND (SUBSTR(m.menuCode, 1, 4) = NVL(#{menu_cate}, '') OR NVL(#{menu_cate}, '') = '')
	          AND (SUBSTR(m.menuCode, 5, 1) = NVL(#{menu_base}, '') OR NVL(#{menu_base}, '') = '')
	          AND m.menuName LIKE '%' || NVL(#{menuName}, '') || '%'
	          AND m.menuEnable = 'Y'
	    ) AS drinks 
	    WHERE rn BETWEEN #{startRow} AND #{endRow}
	</select>

	<!-- 조건에 해당하는 음료 리스트 갯수 -->
	<select id="searchDrinksCount" parameterType="java.util.Map" resultType="Integer">
	    SELECT COUNT(*)
	    FROM javabucks_storemenu sm
	    JOIN javabucks_menu m ON sm.menuCode = m.menuCode
	    WHERE sm.bucksId = #{bucksId}
	      AND sm.storemenuStatus = 'Y'
	      AND (SUBSTR(m.menuCode, 1, 4) = NVL(#{menu_cate}, '') OR NVL(#{menu_cate}, '') = '')
	      AND (SUBSTR(m.menuCode, 5, 1) = NVL(#{menu_base}, '') OR NVL(#{menu_base}, '') = '')
	      AND m.menuName LIKE '%' || NVL(#{menuName}, '') || '%'
	      AND m.menuEnable = 'Y'
	</select>
</mapper>